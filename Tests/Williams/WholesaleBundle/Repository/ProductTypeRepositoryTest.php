<?php

use GuzzleHttp\Client;
use GuzzleHttp\Handler\MockHandler;
use GuzzleHttp\HandlerStack;
use GuzzleHttp\Psr7\Response;
use PHPUnit\Framework\TestCase;
use Williams\WholesaleBundle\Repository\ProductTypeRepository;

class ProductTypeRepositoryTest extends TestCase {

    public function testFindAll() {

        $response = new Response(200, ['X-Content-Range' => 'items 0-73/73'], "{\"types\":[{\"id\":\"35\",\"code\":\"DVDF\",\"name\":\"DVD's- Frontline\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"1\",\"active\":\"0\"},{\"id\":\"36\",\"code\":\"DISC\",\"name\":\"Discontinued (Manufactures)\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"37\",\"code\":\"LI\",\"name\":\"Lingerie\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"38\",\"code\":\"BR1\",\"name\":\"Manufactures back order 2x\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"39\",\"code\":\"VIDS\",\"name\":\"DVD Sale\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"1\",\"active\":\"1\"},{\"id\":\"40\",\"code\":\"DVED\",\"name\":\"Educational DVDs\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"1\",\"active\":\"1\"},{\"id\":\"41\",\"code\":\"DVDS\",\"name\":\"DVD Blowout Sale\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"1\",\"active\":\"1\"},{\"id\":\"42\",\"code\":\"DVMC\",\"name\":\"DVD's (Always in Stock)\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"1\",\"active\":\"1\"},{\"id\":\"43\",\"code\":\"DVDC\",\"name\":\"DVD Catalog\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"1\",\"active\":\"1\"},{\"id\":\"44\",\"code\":\"NV\",\"name\":\"All Novelties\",\"description\":null,\"max_discount_rate\":\"35\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"46\",\"code\":\"CO\",\"name\":\"Condoms\",\"description\":null,\"max_discount_rate\":\"35\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"47\",\"code\":\"LU\",\"name\":\"Lubes\",\"description\":null,\"max_discount_rate\":\"20\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"48\",\"code\":\"WD\",\"name\":\"Discontinued (Williams)\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"49\",\"code\":\"VIDF\",\"name\":\"VHS Frontline\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"1\",\"active\":\"1\"},{\"id\":\"50\",\"code\":\"BR\",\"name\":\"Manufactures back order\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"52\",\"code\":\"GM\",\"name\":\"Games\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"53\",\"code\":\"VR\",\"name\":\"VR\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"0\"},{\"id\":\"54\",\"code\":\"NRI\",\"name\":\"NRI\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"0\"},{\"id\":\"55\",\"code\":\"CLAD\",\"name\":\"DVD's- Classic\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"1\",\"active\":\"1\"},{\"id\":\"56\",\"code\":\"BA\",\"name\":\"Bachelorette\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"57\",\"code\":\"CAT\",\"name\":\"Catalogs\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"58\",\"code\":\"BO\",\"name\":\"Bondage\",\"description\":null,\"max_discount_rate\":\"20\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"59\",\"code\":\"WDB\",\"name\":\"Blowout Items\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"60\",\"code\":\"MG\",\"name\":\"Mags and Comics\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"61\",\"code\":\"LIC\",\"name\":\"Costumes\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"62\",\"code\":\"XM\",\"name\":\"Holiday Items \",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"63\",\"code\":\"BR3\",\"name\":\"Manufactures back order 4x\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"64\",\"code\":\"BR2\",\"name\":\"Manufactures back order 3x\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"65\",\"code\":\"HAZ\",\"name\":\"Hazardous Materials \",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"66\",\"code\":\"DO\",\"name\":\"Dolls\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"67\",\"code\":\"BAT\",\"name\":\"Batteries\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"69\",\"code\":\"DSP\",\"name\":\"Floor \/ Counter Displays\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"70\",\"code\":\"PROM\",\"name\":\"Promotional Items \",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"0\"},{\"id\":\"71\",\"code\":\"RPI\",\"name\":\"RPI\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"72\",\"code\":\"DJ\",\"name\":\"DJ\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"73\",\"code\":\"ST\",\"name\":\"ST\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"75\",\"code\":\"PIL\",\"name\":\"Pills\/ Sexual Enhancement\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"76\",\"code\":\"WIG\",\"name\":\"Mask, Pasties, Body\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"77\",\"code\":\"VA\",\"name\":\"Valentine Items\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"78\",\"code\":\"FD\",\"name\":\"51 Shades of Williams\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"79\",\"code\":\"HS\",\"name\":\"HS\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"80\",\"code\":\"VIDC\",\"name\":\"VIDC\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"81\",\"code\":\"VIMC\",\"name\":\"VIMC\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"82\",\"code\":\"HC\",\"name\":\"HC\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"83\",\"code\":\"BR9\",\"name\":\"BR9\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"84\",\"code\":\"NET\",\"name\":\"NET\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"85\",\"code\":\"SHO\",\"name\":\"Shoes\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"86\",\"code\":\"BK\",\"name\":\"Books\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"87\",\"code\":\"E\",\"name\":\"E\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"0\"},{\"id\":\"88\",\"code\":\"R\",\"name\":\"R\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"0\"},{\"id\":\"89\",\"code\":\"D\",\"name\":\"D\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"0\"},{\"id\":\"90\",\"code\":\"N\",\"name\":\"N\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"0\"},{\"id\":\"91\",\"code\":\"HW\",\"name\":\"HW\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"92\",\"code\":\"0.0\",\"name\":\"0.0\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"0\"},{\"id\":\"93\",\"code\":\"FRT\",\"name\":\"FRT\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"94\",\"code\":\"SHP\",\"name\":\"SHP\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"95\",\"code\":\"SE\",\"name\":\"SE\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"0\"},{\"id\":\"96\",\"code\":\"SAMPLES\",\"name\":\"SAMPLES\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"97\",\"code\":\"BU\",\"name\":\"BULK Items (Not in retail packaging)\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"98\",\"code\":\"\",\"name\":\"\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"0\"},{\"id\":\"99\",\"code\":\"DISP\",\"name\":\"DISP\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"100\",\"code\":\"FS\",\"name\":\"50 SHADES OF GREY\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"101\",\"code\":\"BKED\",\"name\":\"BKED\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"102\",\"code\":\"GFF\",\"name\":\"GFF\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"103\",\"code\":\"NC\",\"name\":\"NC\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"104\",\"code\":\"MAG\",\"name\":\"MAG\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"105\",\"code\":\"35.00\",\"name\":\"35.00\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"106\",\"code\":\"DICS\",\"name\":\"DICS\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"107\",\"code\":\"GA\",\"name\":\"GA\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"108\",\"code\":\"ND\",\"name\":\"ND\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"109\",\"code\":\"DISCI\",\"name\":\"DISCI\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"110\",\"code\":\"DIS\",\"name\":\"DIS\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"},{\"id\":\"111\",\"code\":\"(WD)\",\"name\":\"(WD)\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"0\",\"active\":\"1\"}]}");

        $mock = new MockHandler([
            $response
        ]);

        $handler = HandlerStack::create($mock);
        $client = new Client(['handler' => $handler]);

        $repo = new ProductTypeRepository($client);

        $result = $repo->findAll();
        
        $this->assertEquals(73, sizeof($result->getItems()));
        $this->assertEquals("35", $result->getItems()[0]->getId());
        $this->assertEquals(73, $result->getTotal());
        
    }
    
    public function testFind() {

        $response = new Response(200, [], "{\"type\":{\"id\":\"35\",\"code\":\"DVDF\",\"name\":\"DVD's- Frontline\",\"description\":null,\"max_discount_rate\":\"0\",\"video\":\"1\",\"active\":\"0\"}}");

        $mock = new MockHandler([
            $response
        ]);

        $handler = HandlerStack::create($mock);
        $client = new Client(['handler' => $handler]);

        $repo = new ProductTypeRepository($client);

        $result = $repo->find(35);
        
        $this->assertEquals("35", $result->getId());
        
    }

}
