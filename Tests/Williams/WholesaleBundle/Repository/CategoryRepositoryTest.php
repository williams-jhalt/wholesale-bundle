<?php

use GuzzleHttp\Client;
use GuzzleHttp\Handler\MockHandler;
use GuzzleHttp\HandlerStack;
use GuzzleHttp\Psr7\Response;
use PHPUnit\Framework\TestCase;
use Williams\WholesaleBundle\Repository\CategoryRepository;

class CategoryRepositoryTest extends TestCase {

    public function testFindAll() {

        $response = new Response(200, ['X-Content-Range' => 'items 0-100/234'], '{"categories":[{"id":"818","code":"811","name":"Party Games, Gifts & Supplies","description":null,"active":"1","parent_id":"0","video":"0","lft":"1","rgt":"46"},{"id":"819","code":"477","name":"Adult Candy and Erotic Foods","description":null,"active":"1","parent_id":"818","video":"0","lft":"2","rgt":"7"},{"id":"820","code":"164","name":"Adult Party Supplies","description":null,"active":"1","parent_id":"818","video":"0","lft":"8","rgt":"21"},{"id":"821","code":"554","name":"For the Bachelor Party","description":null,"active":"1","parent_id":"818","video":"0","lft":"22","rgt":"23"},{"id":"823","code":"497","name":"Party Favors","description":null,"active":"1","parent_id":"820","video":"0","lft":"9","rgt":"10"},{"id":"824","code":"152","name":"X-rated Adult Games","description":null,"active":"1","parent_id":"886","video":"0","lft":"206","rgt":"207"},{"id":"826","code":"153","name":"DVD and Video","description":null,"active":"1","parent_id":"0","video":"0","lft":"47","rgt":"56"},{"id":"828","code":"101","name":"Latex","description":null,"active":"1","parent_id":"833","video":"0","lft":"90","rgt":"91"},{"id":"830","code":"166","name":"Clothing & Sexy Clubwear","description":null,"active":"1","parent_id":"831","video":"0","lft":"58","rgt":"59"},{"id":"831","code":"172","name":"Lingerie & Clothing","description":null,"active":"1","parent_id":"0","video":"0","lft":"57","rgt":"88"},{"id":"832","code":"641","name":"Sexy Costume Accessories","description":null,"active":"1","parent_id":"831","video":"0","lft":"60","rgt":"61"},{"id":"833","code":"44","name":"Bondage, Fetish & Kink","description":null,"active":"1","parent_id":"0","video":"0","lft":"89","rgt":"118"},{"id":"834","code":"80","name":"Blindfolds","description":null,"active":"1","parent_id":"833","video":"0","lft":"92","rgt":"93"},{"id":"835","code":"186","name":"Bra Sets","description":null,"active":"1","parent_id":"831","video":"0","lft":"62","rgt":"63"},{"id":"837","code":"187","name":"Womens Underwear","description":null,"active":"1","parent_id":"831","video":"0","lft":"64","rgt":"65"},{"id":"839","code":"640","name":"Naughty Role Play","description":null,"active":"1","parent_id":"831","video":"0","lft":"66","rgt":"67"},{"id":"840","code":"189","name":"Teddies","description":null,"active":"1","parent_id":"831","video":"0","lft":"68","rgt":"69"},{"id":"841","code":"222","name":"Instructional","description":null,"active":"1","parent_id":"826","video":"0","lft":"48","rgt":"49"},{"id":"846","code":"179","name":"Babydolls & Slips","description":null,"active":"1","parent_id":"831","video":"0","lft":"70","rgt":"71"},{"id":"848","code":"366","name":"Mens Underwear","description":null,"active":"1","parent_id":"831","video":"0","lft":"72","rgt":"73"},{"id":"851","code":"36","name":"Anal Toys","description":null,"active":"1","parent_id":"0","video":"0","lft":"119","rgt":"140"},{"id":"852","code":"39","name":"Prostate Massagers & P Spot Stimulators","description":null,"active":"1","parent_id":"851","video":"0","lft":"120","rgt":"121"},{"id":"853","code":"20","name":"Masturbators","description":null,"active":"1","parent_id":"903","video":"0","lft":"308","rgt":"349"},{"id":"854","code":"387","name":"Prostate Massagers","description":null,"active":"1","parent_id":"853","video":"0","lft":"309","rgt":"310"},{"id":"855","code":"481","name":"Valentines Day","description":null,"active":"1","parent_id":"1765","video":"0","lft":"462","rgt":"463"},{"id":"857","code":"470","name":"Small & Medium Butt Plugs","description":null,"active":"1","parent_id":"851","video":"0","lft":"122","rgt":"123"},{"id":"860","code":"176","name":"Condoms","description":null,"active":"1","parent_id":"0","video":"0","lft":"141","rgt":"158"},{"id":"862","code":"42","name":"Erotic Body Lotions","description":null,"active":"1","parent_id":"0","video":"0","lft":"159","rgt":"180"},{"id":"863","code":"232","name":"Sprays","description":null,"active":"1","parent_id":"862","video":"0","lft":"160","rgt":"161"},{"id":"864","code":"528","name":"Lubricants","description":null,"active":"1","parent_id":"0","video":"0","lft":"181","rgt":"198"},{"id":"865","code":"529","name":"Desensitizing","description":null,"active":"1","parent_id":"864","video":"0","lft":"182","rgt":"183"},{"id":"866","code":"154","name":"Meds & Supplements","description":null,"active":"1","parent_id":"0","video":"0","lft":"199","rgt":"204"},{"id":"867","code":"236","name":"Sex Pills","description":null,"active":"1","parent_id":"866","video":"0","lft":"200","rgt":"201"},{"id":"868","code":"385","name":"Body Paints & Dessert Toppings","description":null,"active":"1","parent_id":"862","video":"0","lft":"162","rgt":"163"},{"id":"869","code":"535","name":"Water-Based","description":null,"active":"1","parent_id":"864","video":"0","lft":"184","rgt":"185"},{"id":"870","code":"533","name":"Silicone-Based","description":null,"active":"1","parent_id":"864","video":"0","lft":"186","rgt":"187"},{"id":"872","code":"384","name":"Gels","description":null,"active":"1","parent_id":"862","video":"0","lft":"164","rgt":"165"},{"id":"873","code":"254","name":"Creams","description":null,"active":"1","parent_id":"862","video":"0","lft":"166","rgt":"167"},{"id":"874","code":"531","name":"Flavored","description":null,"active":"1","parent_id":"864","video":"0","lft":"188","rgt":"189"},{"id":"875","code":"534","name":"Warming & Tingling","description":null,"active":"1","parent_id":"864","video":"0","lft":"190","rgt":"191"},{"id":"876","code":"475","name":"Anal Lubes, Lotions, Sprays & Creams","description":null,"active":"1","parent_id":"851","video":"0","lft":"124","rgt":"125"},{"id":"882","code":"536","name":"Oil-Based","description":null,"active":"1","parent_id":"864","video":"0","lft":"192","rgt":"193"},{"id":"883","code":"544","name":"Maturbation Creams & Lotions","description":null,"active":"1","parent_id":"853","video":"0","lft":"311","rgt":"312"},{"id":"886","code":"175","name":"Books, Adult Games & Music","description":null,"active":"1","parent_id":"0","video":"0","lft":"205","rgt":"214"},{"id":"888","code":"43","name":"Sex Swings, Machines & Erotic Furniture","description":null,"active":"1","parent_id":"833","video":"0","lft":"94","rgt":"95"},{"id":"890","code":"41","name":"Probes, Sticks & Rods","description":null,"active":"1","parent_id":"851","video":"0","lft":"126","rgt":"127"},{"id":"892","code":"3","name":"Vibrators","description":null,"active":"1","parent_id":"0","video":"0","lft":"215","rgt":"286"},{"id":"893","code":"5","name":"Classic Vibrators","description":null,"active":"1","parent_id":"892","video":"0","lft":"216","rgt":"225"},{"id":"895","code":"378","name":"Clitoral","description":null,"active":"1","parent_id":"892","video":"0","lft":"226","rgt":"227"},{"id":"896","code":"8","name":"Bullets & Eggs","description":null,"active":"1","parent_id":"892","video":"0","lft":"228","rgt":"235"},{"id":"897","code":"651","name":"One-Touch Bullets","description":null,"active":"1","parent_id":"896","video":"0","lft":"229","rgt":"230"},{"id":"898","code":"240","name":"Masturbator Trios","description":null,"active":"1","parent_id":"853","video":"0","lft":"313","rgt":"314"},{"id":"900","code":"25","name":"Sextoys for Couples","description":null,"active":"1","parent_id":"0","video":"0","lft":"287","rgt":"306"},{"id":"901","code":"159","name":"Love Rings","description":null,"active":"1","parent_id":"900","video":"0","lft":"288","rgt":"289"},{"id":"903","code":"669","name":"Sextoys for Men","description":null,"active":"1","parent_id":"0","video":"0","lft":"307","rgt":"386"},{"id":"904","code":"718","name":"Cock Rings","description":null,"active":"1","parent_id":"903","video":"0","lft":"350","rgt":"365"},{"id":"905","code":"723","name":"Couples Cock Rings","description":null,"active":"1","parent_id":"904","video":"0","lft":"351","rgt":"352"},{"id":"906","code":"682","name":"Love Rings","description":null,"active":"1","parent_id":"892","video":"0","lft":"236","rgt":"237"},{"id":"907","code":"649","name":"Discreet Vibrators","description":null,"active":"1","parent_id":"892","video":"0","lft":"238","rgt":"239"},{"id":"908","code":"4","name":"Novelty Vibrators","description":null,"active":"1","parent_id":"892","video":"0","lft":"240","rgt":"241"},{"id":"909","code":"7","name":"Rabbit Style Vibrators","description":null,"active":"1","parent_id":"892","video":"0","lft":"242","rgt":"243"},{"id":"910","code":"758","name":"Firm Vibrators","description":null,"active":"1","parent_id":"893","video":"0","lft":"217","rgt":"218"},{"id":"911","code":"33","name":"Eco-Friendly Sex Toys","description":null,"active":"1","parent_id":"892","video":"0","lft":"244","rgt":"251"},{"id":"912","code":"14","name":"Rechargeable Vibrators","description":null,"active":"1","parent_id":"911","video":"0","lft":"245","rgt":"246"},{"id":"913","code":"15","name":"Magic Wands & Body Massagers","description":null,"active":"1","parent_id":"892","video":"0","lft":"252","rgt":"253"},{"id":"914","code":"745","name":"Flexible Vibrators","description":null,"active":"1","parent_id":"893","video":"0","lft":"219","rgt":"220"},{"id":"915","code":"6","name":"Tongue Vibrators","description":null,"active":"1","parent_id":"892","video":"0","lft":"254","rgt":"255"},{"id":"916","code":"28","name":"Oral Products","description":null,"active":"1","parent_id":"900","video":"0","lft":"290","rgt":"291"},{"id":"917","code":"239","name":"Finger Vibrators","description":null,"active":"1","parent_id":"892","video":"0","lft":"256","rgt":"257"},{"id":"918","code":"22","name":"Penis Pumps","description":null,"active":"1","parent_id":"853","video":"0","lft":"315","rgt":"322"},{"id":"919","code":"537","name":"Accessories","description":null,"active":"1","parent_id":"918","video":"0","lft":"316","rgt":"317"},{"id":"920","code":"720","name":"Male Pump Accessories","description":null,"active":"1","parent_id":"903","video":"0","lft":"366","rgt":"367"},{"id":"922","code":"539","name":"Pumps without sleeves","description":null,"active":"1","parent_id":"918","video":"0","lft":"318","rgt":"319"},{"id":"923","code":"717","name":"Male Pumps","description":null,"active":"1","parent_id":"903","video":"0","lft":"368","rgt":"377"},{"id":"925","code":"11","name":"G Spot","description":null,"active":"1","parent_id":"892","video":"0","lft":"258","rgt":"269"},{"id":"926","code":"746","name":"G Spot Firm Vibrators","description":null,"active":"1","parent_id":"925","video":"0","lft":"259","rgt":"260"},{"id":"928","code":"171","name":"Body Massagers","description":null,"active":"1","parent_id":"934","video":"0","lft":"388","rgt":"395"},{"id":"929","code":"596","name":"Body Massagers","description":null,"active":"1","parent_id":"928","video":"0","lft":"389","rgt":"390"},{"id":"930","code":"372","name":"Palm Size Massagers","description":null,"active":"1","parent_id":"928","video":"0","lft":"391","rgt":"392"},{"id":"931","code":"476","name":"Palm Size Massagers","description":null,"active":"1","parent_id":"892","video":"0","lft":"270","rgt":"271"},{"id":"934","code":"168","name":"Health & Beauty","description":null,"active":"1","parent_id":"0","video":"0","lft":"387","rgt":"408"},{"id":"935","code":"242","name":"Candles","description":null,"active":"1","parent_id":"934","video":"0","lft":"396","rgt":"397"},{"id":"938","code":"612","name":"Candles","description":null,"active":"1","parent_id":"934","video":"0","lft":"398","rgt":"399"},{"id":"939","code":"169","name":"Bath Time","description":null,"active":"1","parent_id":"934","video":"0","lft":"400","rgt":"401"},{"id":"941","code":"623","name":"Adult Gags, Gifts and Novelties","description":null,"active":"1","parent_id":"818","video":"0","lft":"24","rgt":"41"},{"id":"942","code":"714","name":"Bathroom Humor","description":null,"active":"1","parent_id":"941","video":"0","lft":"25","rgt":"26"},{"id":"949","code":"492","name":"Adult Party Favors","description":null,"active":"1","parent_id":"820","video":"0","lft":"11","rgt":"12"},{"id":"951","code":"562","name":"Mints","description":null,"active":"1","parent_id":"819","video":"0","lft":"3","rgt":"4"},{"id":"952","code":"196","name":"Xmas items","description":null,"active":"1","parent_id":"1765","video":"0","lft":"464","rgt":"465"},{"id":"953","code":"683","name":"Birthday","description":null,"active":"1","parent_id":"941","video":"0","lft":"27","rgt":"28"},{"id":"955","code":"564","name":"Lollipops","description":null,"active":"1","parent_id":"819","video":"0","lft":"5","rgt":"6"},{"id":"956","code":"490","name":"Risque Party Wear","description":null,"active":"1","parent_id":"820","video":"0","lft":"13","rgt":"14"},{"id":"961","code":"677","name":"Risque Office Supplies","description":null,"active":"1","parent_id":"941","video":"0","lft":"29","rgt":"30"},{"id":"962","code":"674","name":"For the Bachelorette Party","description":null,"active":"1","parent_id":"818","video":"0","lft":"42","rgt":"43"},{"id":"963","code":"685","name":"Catalogs, Sales Tools & Promotional Items","description":null,"active":"1","parent_id":"0","video":"0","lft":"409","rgt":"410"},{"id":"965","code":"46","name":"Whips, Paddles & Ticklers","description":null,"active":"1","parent_id":"833","video":"0","lft":"96","rgt":"97"},{"id":"968","code":"61","name":"Bondage Restraints","description":null,"active":"1","parent_id":"833","video":"0","lft":"98","rgt":"99"},{"id":"970","code":"698","name":"Collars & Leashes","description":null,"active":"1","parent_id":"833","video":"0","lft":"100","rgt":"101"},{"id":"972","code":"16","name":"Strap-ons & Harnesses","description":null,"active":"1","parent_id":"1019","video":"0","lft":"432","rgt":"433"},{"id":"974","code":"241","name":"Bondage, Fetish & Kink Kits","description":null,"active":"1","parent_id":"833","video":"0","lft":"102","rgt":"103"}]}');

        $mock = new MockHandler([
            $response
        ]);

        $handler = HandlerStack::create($mock);
        $client = new Client(['handler' => $handler]);

        $repo = new CategoryRepository($client);

        $result = $repo->findAll();
        
        $this->assertEquals(100, sizeof($result->getItems()));
        $this->assertEquals("818", $result->getItems()[0]->getId());
        $this->assertEquals(234, $result->getTotal());
        
    }
    
    public function testFindByParent() {

        $response = new Response(200, ['X-Content-Range' => 'items 0-100/234'], '{"categories":[{"id":"818","code":"811","name":"Party Games, Gifts & Supplies","description":null,"active":"1","parent_id":"0","video":"0","lft":"1","rgt":"46"},{"id":"819","code":"477","name":"Adult Candy and Erotic Foods","description":null,"active":"1","parent_id":"818","video":"0","lft":"2","rgt":"7"},{"id":"820","code":"164","name":"Adult Party Supplies","description":null,"active":"1","parent_id":"818","video":"0","lft":"8","rgt":"21"},{"id":"821","code":"554","name":"For the Bachelor Party","description":null,"active":"1","parent_id":"818","video":"0","lft":"22","rgt":"23"},{"id":"823","code":"497","name":"Party Favors","description":null,"active":"1","parent_id":"820","video":"0","lft":"9","rgt":"10"},{"id":"824","code":"152","name":"X-rated Adult Games","description":null,"active":"1","parent_id":"886","video":"0","lft":"206","rgt":"207"},{"id":"826","code":"153","name":"DVD and Video","description":null,"active":"1","parent_id":"0","video":"0","lft":"47","rgt":"56"},{"id":"828","code":"101","name":"Latex","description":null,"active":"1","parent_id":"833","video":"0","lft":"90","rgt":"91"},{"id":"830","code":"166","name":"Clothing & Sexy Clubwear","description":null,"active":"1","parent_id":"831","video":"0","lft":"58","rgt":"59"},{"id":"831","code":"172","name":"Lingerie & Clothing","description":null,"active":"1","parent_id":"0","video":"0","lft":"57","rgt":"88"},{"id":"832","code":"641","name":"Sexy Costume Accessories","description":null,"active":"1","parent_id":"831","video":"0","lft":"60","rgt":"61"},{"id":"833","code":"44","name":"Bondage, Fetish & Kink","description":null,"active":"1","parent_id":"0","video":"0","lft":"89","rgt":"118"},{"id":"834","code":"80","name":"Blindfolds","description":null,"active":"1","parent_id":"833","video":"0","lft":"92","rgt":"93"},{"id":"835","code":"186","name":"Bra Sets","description":null,"active":"1","parent_id":"831","video":"0","lft":"62","rgt":"63"},{"id":"837","code":"187","name":"Womens Underwear","description":null,"active":"1","parent_id":"831","video":"0","lft":"64","rgt":"65"},{"id":"839","code":"640","name":"Naughty Role Play","description":null,"active":"1","parent_id":"831","video":"0","lft":"66","rgt":"67"},{"id":"840","code":"189","name":"Teddies","description":null,"active":"1","parent_id":"831","video":"0","lft":"68","rgt":"69"},{"id":"841","code":"222","name":"Instructional","description":null,"active":"1","parent_id":"826","video":"0","lft":"48","rgt":"49"},{"id":"846","code":"179","name":"Babydolls & Slips","description":null,"active":"1","parent_id":"831","video":"0","lft":"70","rgt":"71"},{"id":"848","code":"366","name":"Mens Underwear","description":null,"active":"1","parent_id":"831","video":"0","lft":"72","rgt":"73"},{"id":"851","code":"36","name":"Anal Toys","description":null,"active":"1","parent_id":"0","video":"0","lft":"119","rgt":"140"},{"id":"852","code":"39","name":"Prostate Massagers & P Spot Stimulators","description":null,"active":"1","parent_id":"851","video":"0","lft":"120","rgt":"121"},{"id":"853","code":"20","name":"Masturbators","description":null,"active":"1","parent_id":"903","video":"0","lft":"308","rgt":"349"},{"id":"854","code":"387","name":"Prostate Massagers","description":null,"active":"1","parent_id":"853","video":"0","lft":"309","rgt":"310"},{"id":"855","code":"481","name":"Valentines Day","description":null,"active":"1","parent_id":"1765","video":"0","lft":"462","rgt":"463"},{"id":"857","code":"470","name":"Small & Medium Butt Plugs","description":null,"active":"1","parent_id":"851","video":"0","lft":"122","rgt":"123"},{"id":"860","code":"176","name":"Condoms","description":null,"active":"1","parent_id":"0","video":"0","lft":"141","rgt":"158"},{"id":"862","code":"42","name":"Erotic Body Lotions","description":null,"active":"1","parent_id":"0","video":"0","lft":"159","rgt":"180"},{"id":"863","code":"232","name":"Sprays","description":null,"active":"1","parent_id":"862","video":"0","lft":"160","rgt":"161"},{"id":"864","code":"528","name":"Lubricants","description":null,"active":"1","parent_id":"0","video":"0","lft":"181","rgt":"198"},{"id":"865","code":"529","name":"Desensitizing","description":null,"active":"1","parent_id":"864","video":"0","lft":"182","rgt":"183"},{"id":"866","code":"154","name":"Meds & Supplements","description":null,"active":"1","parent_id":"0","video":"0","lft":"199","rgt":"204"},{"id":"867","code":"236","name":"Sex Pills","description":null,"active":"1","parent_id":"866","video":"0","lft":"200","rgt":"201"},{"id":"868","code":"385","name":"Body Paints & Dessert Toppings","description":null,"active":"1","parent_id":"862","video":"0","lft":"162","rgt":"163"},{"id":"869","code":"535","name":"Water-Based","description":null,"active":"1","parent_id":"864","video":"0","lft":"184","rgt":"185"},{"id":"870","code":"533","name":"Silicone-Based","description":null,"active":"1","parent_id":"864","video":"0","lft":"186","rgt":"187"},{"id":"872","code":"384","name":"Gels","description":null,"active":"1","parent_id":"862","video":"0","lft":"164","rgt":"165"},{"id":"873","code":"254","name":"Creams","description":null,"active":"1","parent_id":"862","video":"0","lft":"166","rgt":"167"},{"id":"874","code":"531","name":"Flavored","description":null,"active":"1","parent_id":"864","video":"0","lft":"188","rgt":"189"},{"id":"875","code":"534","name":"Warming & Tingling","description":null,"active":"1","parent_id":"864","video":"0","lft":"190","rgt":"191"},{"id":"876","code":"475","name":"Anal Lubes, Lotions, Sprays & Creams","description":null,"active":"1","parent_id":"851","video":"0","lft":"124","rgt":"125"},{"id":"882","code":"536","name":"Oil-Based","description":null,"active":"1","parent_id":"864","video":"0","lft":"192","rgt":"193"},{"id":"883","code":"544","name":"Maturbation Creams & Lotions","description":null,"active":"1","parent_id":"853","video":"0","lft":"311","rgt":"312"},{"id":"886","code":"175","name":"Books, Adult Games & Music","description":null,"active":"1","parent_id":"0","video":"0","lft":"205","rgt":"214"},{"id":"888","code":"43","name":"Sex Swings, Machines & Erotic Furniture","description":null,"active":"1","parent_id":"833","video":"0","lft":"94","rgt":"95"},{"id":"890","code":"41","name":"Probes, Sticks & Rods","description":null,"active":"1","parent_id":"851","video":"0","lft":"126","rgt":"127"},{"id":"892","code":"3","name":"Vibrators","description":null,"active":"1","parent_id":"0","video":"0","lft":"215","rgt":"286"},{"id":"893","code":"5","name":"Classic Vibrators","description":null,"active":"1","parent_id":"892","video":"0","lft":"216","rgt":"225"},{"id":"895","code":"378","name":"Clitoral","description":null,"active":"1","parent_id":"892","video":"0","lft":"226","rgt":"227"},{"id":"896","code":"8","name":"Bullets & Eggs","description":null,"active":"1","parent_id":"892","video":"0","lft":"228","rgt":"235"},{"id":"897","code":"651","name":"One-Touch Bullets","description":null,"active":"1","parent_id":"896","video":"0","lft":"229","rgt":"230"},{"id":"898","code":"240","name":"Masturbator Trios","description":null,"active":"1","parent_id":"853","video":"0","lft":"313","rgt":"314"},{"id":"900","code":"25","name":"Sextoys for Couples","description":null,"active":"1","parent_id":"0","video":"0","lft":"287","rgt":"306"},{"id":"901","code":"159","name":"Love Rings","description":null,"active":"1","parent_id":"900","video":"0","lft":"288","rgt":"289"},{"id":"903","code":"669","name":"Sextoys for Men","description":null,"active":"1","parent_id":"0","video":"0","lft":"307","rgt":"386"},{"id":"904","code":"718","name":"Cock Rings","description":null,"active":"1","parent_id":"903","video":"0","lft":"350","rgt":"365"},{"id":"905","code":"723","name":"Couples Cock Rings","description":null,"active":"1","parent_id":"904","video":"0","lft":"351","rgt":"352"},{"id":"906","code":"682","name":"Love Rings","description":null,"active":"1","parent_id":"892","video":"0","lft":"236","rgt":"237"},{"id":"907","code":"649","name":"Discreet Vibrators","description":null,"active":"1","parent_id":"892","video":"0","lft":"238","rgt":"239"},{"id":"908","code":"4","name":"Novelty Vibrators","description":null,"active":"1","parent_id":"892","video":"0","lft":"240","rgt":"241"},{"id":"909","code":"7","name":"Rabbit Style Vibrators","description":null,"active":"1","parent_id":"892","video":"0","lft":"242","rgt":"243"},{"id":"910","code":"758","name":"Firm Vibrators","description":null,"active":"1","parent_id":"893","video":"0","lft":"217","rgt":"218"},{"id":"911","code":"33","name":"Eco-Friendly Sex Toys","description":null,"active":"1","parent_id":"892","video":"0","lft":"244","rgt":"251"},{"id":"912","code":"14","name":"Rechargeable Vibrators","description":null,"active":"1","parent_id":"911","video":"0","lft":"245","rgt":"246"},{"id":"913","code":"15","name":"Magic Wands & Body Massagers","description":null,"active":"1","parent_id":"892","video":"0","lft":"252","rgt":"253"},{"id":"914","code":"745","name":"Flexible Vibrators","description":null,"active":"1","parent_id":"893","video":"0","lft":"219","rgt":"220"},{"id":"915","code":"6","name":"Tongue Vibrators","description":null,"active":"1","parent_id":"892","video":"0","lft":"254","rgt":"255"},{"id":"916","code":"28","name":"Oral Products","description":null,"active":"1","parent_id":"900","video":"0","lft":"290","rgt":"291"},{"id":"917","code":"239","name":"Finger Vibrators","description":null,"active":"1","parent_id":"892","video":"0","lft":"256","rgt":"257"},{"id":"918","code":"22","name":"Penis Pumps","description":null,"active":"1","parent_id":"853","video":"0","lft":"315","rgt":"322"},{"id":"919","code":"537","name":"Accessories","description":null,"active":"1","parent_id":"918","video":"0","lft":"316","rgt":"317"},{"id":"920","code":"720","name":"Male Pump Accessories","description":null,"active":"1","parent_id":"903","video":"0","lft":"366","rgt":"367"},{"id":"922","code":"539","name":"Pumps without sleeves","description":null,"active":"1","parent_id":"918","video":"0","lft":"318","rgt":"319"},{"id":"923","code":"717","name":"Male Pumps","description":null,"active":"1","parent_id":"903","video":"0","lft":"368","rgt":"377"},{"id":"925","code":"11","name":"G Spot","description":null,"active":"1","parent_id":"892","video":"0","lft":"258","rgt":"269"},{"id":"926","code":"746","name":"G Spot Firm Vibrators","description":null,"active":"1","parent_id":"925","video":"0","lft":"259","rgt":"260"},{"id":"928","code":"171","name":"Body Massagers","description":null,"active":"1","parent_id":"934","video":"0","lft":"388","rgt":"395"},{"id":"929","code":"596","name":"Body Massagers","description":null,"active":"1","parent_id":"928","video":"0","lft":"389","rgt":"390"},{"id":"930","code":"372","name":"Palm Size Massagers","description":null,"active":"1","parent_id":"928","video":"0","lft":"391","rgt":"392"},{"id":"931","code":"476","name":"Palm Size Massagers","description":null,"active":"1","parent_id":"892","video":"0","lft":"270","rgt":"271"},{"id":"934","code":"168","name":"Health & Beauty","description":null,"active":"1","parent_id":"0","video":"0","lft":"387","rgt":"408"},{"id":"935","code":"242","name":"Candles","description":null,"active":"1","parent_id":"934","video":"0","lft":"396","rgt":"397"},{"id":"938","code":"612","name":"Candles","description":null,"active":"1","parent_id":"934","video":"0","lft":"398","rgt":"399"},{"id":"939","code":"169","name":"Bath Time","description":null,"active":"1","parent_id":"934","video":"0","lft":"400","rgt":"401"},{"id":"941","code":"623","name":"Adult Gags, Gifts and Novelties","description":null,"active":"1","parent_id":"818","video":"0","lft":"24","rgt":"41"},{"id":"942","code":"714","name":"Bathroom Humor","description":null,"active":"1","parent_id":"941","video":"0","lft":"25","rgt":"26"},{"id":"949","code":"492","name":"Adult Party Favors","description":null,"active":"1","parent_id":"820","video":"0","lft":"11","rgt":"12"},{"id":"951","code":"562","name":"Mints","description":null,"active":"1","parent_id":"819","video":"0","lft":"3","rgt":"4"},{"id":"952","code":"196","name":"Xmas items","description":null,"active":"1","parent_id":"1765","video":"0","lft":"464","rgt":"465"},{"id":"953","code":"683","name":"Birthday","description":null,"active":"1","parent_id":"941","video":"0","lft":"27","rgt":"28"},{"id":"955","code":"564","name":"Lollipops","description":null,"active":"1","parent_id":"819","video":"0","lft":"5","rgt":"6"},{"id":"956","code":"490","name":"Risque Party Wear","description":null,"active":"1","parent_id":"820","video":"0","lft":"13","rgt":"14"},{"id":"961","code":"677","name":"Risque Office Supplies","description":null,"active":"1","parent_id":"941","video":"0","lft":"29","rgt":"30"},{"id":"962","code":"674","name":"For the Bachelorette Party","description":null,"active":"1","parent_id":"818","video":"0","lft":"42","rgt":"43"},{"id":"963","code":"685","name":"Catalogs, Sales Tools & Promotional Items","description":null,"active":"1","parent_id":"0","video":"0","lft":"409","rgt":"410"},{"id":"965","code":"46","name":"Whips, Paddles & Ticklers","description":null,"active":"1","parent_id":"833","video":"0","lft":"96","rgt":"97"},{"id":"968","code":"61","name":"Bondage Restraints","description":null,"active":"1","parent_id":"833","video":"0","lft":"98","rgt":"99"},{"id":"970","code":"698","name":"Collars & Leashes","description":null,"active":"1","parent_id":"833","video":"0","lft":"100","rgt":"101"},{"id":"972","code":"16","name":"Strap-ons & Harnesses","description":null,"active":"1","parent_id":"1019","video":"0","lft":"432","rgt":"433"},{"id":"974","code":"241","name":"Bondage, Fetish & Kink Kits","description":null,"active":"1","parent_id":"833","video":"0","lft":"102","rgt":"103"}]}');

        $response2 = new Response(200, ['X-Content-Range' => 'items 0-6/6'], '{"categories":[{"id":"819","code":"477","name":"Adult Candy and Erotic Foods","description":null,"active":"1","parent_id":"818","video":"0","lft":"2","rgt":"7"},{"id":"820","code":"164","name":"Adult Party Supplies","description":null,"active":"1","parent_id":"818","video":"0","lft":"8","rgt":"21"},{"id":"821","code":"554","name":"For the Bachelor Party","description":null,"active":"1","parent_id":"818","video":"0","lft":"22","rgt":"23"},{"id":"941","code":"623","name":"Adult Gags, Gifts and Novelties","description":null,"active":"1","parent_id":"818","video":"0","lft":"24","rgt":"41"},{"id":"962","code":"674","name":"For the Bachelorette Party","description":null,"active":"1","parent_id":"818","video":"0","lft":"42","rgt":"43"},{"id":"978","code":"493","name":"Adult Party Games","description":null,"active":"1","parent_id":"818","video":"0","lft":"44","rgt":"45"}]}');

        $mock = new MockHandler([
            $response,
            $response2
        ]);

        $handler = HandlerStack::create($mock);
        $client = new Client(['handler' => $handler]);

        $repo = new CategoryRepository($client);

        $result = $repo->findByParent();
        
        $this->assertEquals(100, sizeof($result->getItems()));
        $this->assertEquals("818", $result->getItems()[0]->getId());
        $this->assertEquals(234, $result->getTotal());

        $result2 = $repo->findByParent($result->getItems()[0]->getId());
        
        $this->assertEquals(6, sizeof($result2->getItems()));
        $this->assertEquals("819", $result2->getItems()[0]->getId());
        $this->assertEquals(6, $result2->getTotal());
        
    }
    
    public function testFind() {

        $response = new Response(200, [], '{"category":{"id":"818","code":"811","name":"Party Games, Gifts & Supplies","description":null,"active":"1","parent_id":"0","video":"0","lft":"1","rgt":"46"}}');

        $mock = new MockHandler([
            $response
        ]);

        $handler = HandlerStack::create($mock);
        $client = new Client(['handler' => $handler]);

        $repo = new CategoryRepository($client);

        $result = $repo->find(818);
        
        $this->assertEquals("818", $result->getId());
        
    }

}
