<?php

use GuzzleHttp\Client;
use GuzzleHttp\Handler\MockHandler;
use GuzzleHttp\HandlerStack;
use GuzzleHttp\Psr7\Response;
use PHPUnit\Framework\TestCase;
use Williams\WholesaleBundle\Repository\ProductRepository;

class ProductRepositoryTest extends TestCase {

    public function testFindAll() {

        $response = new Response(200, ['X-Content-Range' => 'items 0-10/52025'], "{\"fields\":null,\"products\":[{\"id\":\"18578\",\"sku\":\"AL1007XO\",\"name\":\"PVC LACE UP GLOVES \",\"description\":\"XOXO Allure Lingerie PVC Gloves. Super sexy gloves will complete your seductress look with these elbow-length lace up PVC gloves. Able to be adjusted as tight as you desire with a lace-and-grommet closure, they extend over the tops of the hands and have a built-in finger loop for a sleek look. A great way to add extra vamp to your look in the bedroom or at the club! Color: Black Type: Gloves Material: PVC Closure: Lacing Length: Elbow Special Features: Finger Loop. \",\"keywords\":\"\",\"price\":\"9\",\"active\":\"0\",\"manufacturer_id\":\"264\",\"barcode\":\"883045010070\",\"stock_quantity\":\"0\",\"reorder_quantity\":\"0\",\"video\":\"0\",\"on_sale\":\"0\",\"height\":\"0\",\"length\":\"0\",\"width\":\"0\",\"diameter\":\"0\",\"weight\":\"0\",\"color\":\"Black\",\"material\":\"PVC\",\"release_date\":\"2008-10-11\",\"created_on\":\"2010-07-12 11:48:09\",\"updated_on\":\"2015-09-30 14:57:38\",\"discountable\":\"0\",\"max_discount_rate\":\"0\",\"type_id\":\"36\",\"saleable\":\"1\"},{\"id\":\"18579\",\"sku\":\"AL100XO\",\"name\":\"LEATHER BLINDFOLD \",\"description\":\"XOXO Allure Lingerie Black Blindfold keep your lover in the dark with this sleek, sexy leather blindfold. The quintessential bondage bedroom accessory, it heightens pleasure by sensory deprivation, allowing your partner to anxiously anticipate your next move. Made of leather with a stretchy strap, Sensual deprivation allows no peeking. Uses and settles snugly to the face to block out light and discourage peeking. Color: Black Type: Blindfold Material: Leather Size: One Size Fits Most\",\"keywords\":\"\",\"price\":\"5\",\"active\":\"1\",\"manufacturer_id\":\"264\",\"barcode\":\"883045300164\",\"stock_quantity\":\"2\",\"reorder_quantity\":\"0\",\"video\":\"0\",\"on_sale\":\"0\",\"height\":\"1.1\",\"length\":\"6.3\",\"width\":\"4.3\",\"diameter\":\"0\",\"weight\":\"0.15\",\"color\":\"Black\",\"material\":\"Leather\",\"release_date\":\"2008-11-10\",\"created_on\":\"2010-07-12 11:48:09\",\"updated_on\":\"2016-07-21 13:10:30\",\"discountable\":\"0\",\"max_discount_rate\":\"0\",\"type_id\":\"37\",\"saleable\":\"1\"},{\"id\":\"18587\",\"sku\":\"AL46077XO\",\"name\":\"(D) PVC STRAP TEDDY \",\"description\":\"XOXO Collection from Allure Lingerie PVC Strap Teddy this is an unforgettable vinyl strap teddy with o-ring detailing and a daring cupless cut. It has an adjustable neck and back, and an elastic g-string. Vinyl accented with large metal rings. Sizes: One size fits most. Naughty role playing wear. Allure Lingerie.\",\"keywords\":\"\",\"price\":\"12.5\",\"active\":\"1\",\"manufacturer_id\":\"264\",\"barcode\":\"883045460776\",\"stock_quantity\":\"0\",\"reorder_quantity\":\"0\",\"video\":\"0\",\"on_sale\":\"0\",\"height\":\"10\",\"length\":\"7.5\",\"width\":\"1.5\",\"diameter\":\"0\",\"weight\":\"0.49\",\"color\":\"Black\",\"material\":\"Vinyl\",\"release_date\":\"2008-11-10\",\"created_on\":\"2010-07-12 11:48:09\",\"updated_on\":\"2017-02-15 14:36:14\",\"discountable\":\"0\",\"max_discount_rate\":\"0\",\"type_id\":\"36\",\"saleable\":\"1\"},{\"id\":\"18588\",\"sku\":\"AL4802XO\",\"name\":\"LEATHER & FISHNET TEDDY O\/S  (D)\",\"description\":\"Leather & Fishnet Teddy OS. This ultra sexy leather and fishnet teddy features a plunging neckline and seductive front lacing. It has an adjustable collar and fishnet thong back. All the allure of see through fishnet with sizzling leather lace up details, this teddy will turn heads! A plunging neckline criss-crosses the body with lacing that trails up to an adjustable collar. A thong-style fishnet back makes you look as hot from the back as you do from the front! Color: Black Type: Teddy Material: Fishnet, Leather Size: One Size Fits Most Closure: Laces\",\"keywords\":\"\",\"price\":\"23.6\",\"active\":\"0\",\"manufacturer_id\":\"264\",\"barcode\":\"883045048028\",\"stock_quantity\":\"0\",\"reorder_quantity\":\"0\",\"video\":\"0\",\"on_sale\":\"0\",\"height\":\"0\",\"length\":\"0\",\"width\":\"0\",\"diameter\":\"0\",\"weight\":\"0\",\"color\":\"\",\"material\":\"\",\"release_date\":\"2008-11-10\",\"created_on\":\"2010-07-12 11:48:09\",\"updated_on\":\"2012-10-13 11:14:29\",\"discountable\":\"0\",\"max_discount_rate\":\"0\",\"type_id\":\"36\",\"saleable\":\"1\"},{\"id\":\"18594\",\"sku\":\"ALE96003\",\"name\":\"(D) TOYS FOR GREAT SEX-DVD \",\"description\":\"Toys For Great Sex DVD is a part of the Loving Sex Series. Enhance Your Sexual Encounters! Instructional erotic programs for lovers who desire incredible sex. This erotic guide explores creative ways of using toys and other objects to enhance a couple's sex life and bring more excitement to their lovemaking. Includes vaginal probes, clitoral vibrators, anal toys and many more. Juli and her friends demonstrate the use of exciting toys in various situations and locations. With Juli Ashton and Devin. Very explicit, 100 minutes. Product dimensions: Height 7.50 inches, length 0.75 inch, width 5.50 inches. Packaged weight 3.52 ounces. Toy For Great Sex DVD from the Alexander Institute. Loving Sex Instructional DVDs have been ranked the best on the market by Men's Health Magazine. Adult movie. Rated XXX. 2014 new\",\"keywords\":\"\",\"price\":\"5.25\",\"active\":\"0\",\"manufacturer_id\":\"266\",\"barcode\":\"677070612060\",\"stock_quantity\":\"0\",\"reorder_quantity\":\"0\",\"video\":\"0\",\"on_sale\":\"0\",\"height\":\"7.5\",\"length\":\"0.75\",\"width\":\"5.5\",\"diameter\":\"0\",\"weight\":\"0.22\",\"color\":\"\",\"material\":\"dvd\",\"release_date\":\"2003-11-06\",\"created_on\":\"2010-07-12 11:48:09\",\"updated_on\":\"2016-09-30 13:24:44\",\"discountable\":\"0\",\"max_discount_rate\":\"0\",\"type_id\":\"84\",\"saleable\":\"1\"},{\"id\":\"18595\",\"sku\":\"ALE96004\",\"name\":\"LOVERS MASSAGE-DVD \",\"description\":\"Lovers Massage DVD is a part of the Loving Sex Series. Giving and Receiving Pleasure: Learn the secrets of sensual loving touch that will leave you and your partner invigorated. Follow our couple as they discover new ways to touch and give each other pleasure. Learn with them about creating the perfect setting, using massage oils, arousing all five senses, and relaxing the entire body to find new erogenous zones. With Tina. Explicit, 60 minutes. Product dimensions: Height 7.50 inches, length 0.75 inch, width 5.50 inches. Packaged weight 3.52 ounces. Lovers Massage DVD from the Alexander Institute. Loving Sex Instructional DVDs have been ranked the best on the market by Men's Health Magazine. Adult movie. Rated XXX. \",\"keywords\":\"\",\"price\":\"5.25\",\"active\":\"1\",\"manufacturer_id\":\"266\",\"barcode\":\"677070601064\",\"stock_quantity\":\"1\",\"reorder_quantity\":\"0\",\"video\":\"0\",\"on_sale\":\"0\",\"height\":\"7.5\",\"length\":\"0.75\",\"width\":\"5.5\",\"diameter\":\"0\",\"weight\":\"0.22\",\"color\":\"\",\"material\":\"dvd\",\"release_date\":\"2003-11-06\",\"created_on\":\"2010-07-12 11:48:09\",\"updated_on\":\"2016-07-21 13:10:35\",\"discountable\":\"0\",\"max_discount_rate\":\"0\",\"type_id\":\"84\",\"saleable\":\"1\"},{\"id\":\"18597\",\"sku\":\"ALE96013\",\"name\":\"SOULMATES #02 ADV. SEX. -DVD \",\"description\":\"Soulmates Volume 2 Advanced Sexual Secrets of Black Lovers from the Alexander Institute's Loving Sex series. Here, at last, is an explicit, uninhibited and comprehensive video that celebrates black love in all its erotic beauty. Based on the book, Soul Mates: An Illustrated Guide to Black Love, Sex, and Romance this video travels deep into zones of sexual pleasure. Volume Two includes explicit segments about sex outside the bedroom, outdoors and in public places, exhilarating role-playing, S&M, sexual fantasies about threesomes and more. Real women and men talk candidly about their experiences and sexual desires. Bursting with hot scenes and practical advice, Soul Mates is a program both for those who have yet to meet the love of their life, and for those who want to preserve and celebrate the love they already share. Topics covered: Seduction techniques that work, Creative role playing, Sex outdoors, Sexual fantasies, sex in public places and experimenting with S&M. Loving Sex Instructional DVDs have been ranked the best on the market by Men's Health Magazine. Adult movie. Rated XXX. Product dimensions: Height 7.50 inches, length 0.75 inch, width 5.50 inches. Packaged weight 3.52 ounces.\",\"keywords\":\"\",\"price\":\"7.5\",\"active\":\"0\",\"manufacturer_id\":\"266\",\"barcode\":\"677070622069\",\"stock_quantity\":\"0\",\"reorder_quantity\":\"0\",\"video\":\"0\",\"on_sale\":\"0\",\"height\":\"7.5\",\"length\":\"0.75\",\"width\":\"5.5\",\"diameter\":\"0\",\"weight\":\"0.22\",\"color\":\"\",\"material\":\"dvd\",\"release_date\":\"2003-11-06\",\"created_on\":\"2010-07-12 11:48:09\",\"updated_on\":\"2015-10-24 09:40:46\",\"discountable\":\"0\",\"max_discount_rate\":\"0\",\"type_id\":\"36\",\"saleable\":\"1\"},{\"id\":\"18598\",\"sku\":\"ALE96014\",\"name\":\"SEXUAL HEALING -DVD(WD)\",\"description\":\"Loving Sex series of informative sexual education videos from the Alexander Institute. Sexual Healing DVD. 29 Sexual Positions for Better Health Combining ancient Oriental healing practices with a new-age, holistic approach to self-help, Sexual Healing explores a variety of sexual techniques and positions known to be helpful in confronting many common ailments. From backaches to weak bladders, chronic fatigue to menopause, Sexual Healing takes a loving, enlightened approach to helping you with what ails you. Watch as our attractive couples demonstrate how sex can be both stimulating and therapeutic. Discover a world of ancient health secrets. Better sex and healthy bodies. Running Time 70 minutes. Product dimensions: Height 7.50 inches, length 0.75 inch, width 5.50 inches. Packaged weight 3.52 ounces. 2014\",\"keywords\":\"\",\"price\":\"7.5\",\"active\":\"0\",\"manufacturer_id\":\"266\",\"barcode\":\"677070640063\",\"stock_quantity\":\"0\",\"reorder_quantity\":\"0\",\"video\":\"0\",\"on_sale\":\"0\",\"height\":\"7.5\",\"length\":\"0.75\",\"width\":\"5.5\",\"diameter\":\"0\",\"weight\":\"0.22\",\"color\":\"\",\"material\":\"dvd\",\"release_date\":\"2003-06-11\",\"created_on\":\"2010-07-12 11:48:09\",\"updated_on\":\"2015-03-10 10:50:02\",\"discountable\":\"0\",\"max_discount_rate\":\"0\",\"type_id\":\"36\",\"saleable\":\"1\"},{\"id\":\"18599\",\"sku\":\"ALE96015\",\"name\":\"SEX, LOVE & EVERYTHING ELSE MOVIE -DVD (D)\",\"description\":\"When two people fall in love, its supposed to be easy, passionate, and fun. But when jealousy, business, and sexual dysfunction get in the way, love can take a disastrous turn. A romantic voyage to the beautiful Pacific Northwest becomes terrifying as Marie's dangerous past drives her lover away. Sam's awakening comes at the hands of a sex surrogate, a professional paid to teach him how to conquer his social and sexual shortcomings. And only by making love to her can he learn how to win back the woman he wants. Sam becomes a student of a unique kind of physical education, drawn into a world of erotic instruction. The results are so eye-opening that Sam suggests therapy might also save the relationship of his friend Trevor, who is in conflict with his stunning wife, Susan. But the big question for Sam remains; when the lesson is over, will Marie still be waiting? It is not just a film about relationships: it is sex, love and everything else. Mature audiences. 85 minutes. Product dimensions: Height 7.50 inches, length 0.75 inch, width 5.50 inches. Packaged weight 3.52 ounces. Loving Sex Instructional DVDs have been ranked the best on the market by Men's Health Magazine. Adult movie. Rated XXX. \",\"keywords\":\"\",\"price\":\"7.5\",\"active\":\"0\",\"manufacturer_id\":\"266\",\"barcode\":\"677070801068\",\"stock_quantity\":\"0\",\"reorder_quantity\":\"0\",\"video\":\"0\",\"on_sale\":\"0\",\"height\":\"7.5\",\"length\":\"0.75\",\"width\":\"5.5\",\"diameter\":\"0\",\"weight\":\"0.22\",\"color\":\"\",\"material\":\"dvd\",\"release_date\":\"2003-11-06\",\"created_on\":\"2010-07-12 11:48:09\",\"updated_on\":\"2014-12-09 09:55:32\",\"discountable\":\"0\",\"max_discount_rate\":\"0\",\"type_id\":\"36\",\"saleable\":\"1\"},{\"id\":\"18600\",\"sku\":\"ALE96016\",\"name\":\"PLANET SEX -DVD  (d)\",\"description\":\"Planet Sex DVD is a part of the Loving Sex Series. Planet Sex is an upbeat, honest and uninhibited exploration of many interesting aspects of sexuality from around the world. From Australia to Norway, the US to Hungary, you will meet real people showing what they like about sex and how they express their sexuality. Visit amazing places, watch tantalizing experiences, examine incredible sex toys, and meet the most beautiful and sexy people from around the globe. Mature, 60 minutes. Product dimensions: Height 7.50 inches, length 0.75 inch, width 5.50 inches. Packaged weight 3.52 ounces. Loving Sex Instructional DVDs have been ranked the best on the market by Men's Health Magazine. Adult movie. Rated XXX. \",\"keywords\":\"\",\"price\":\"7.5\",\"active\":\"0\",\"manufacturer_id\":\"266\",\"barcode\":\"677070802065\",\"stock_quantity\":\"0\",\"reorder_quantity\":\"0\",\"video\":\"0\",\"on_sale\":\"0\",\"height\":\"7.5\",\"length\":\"0.75\",\"width\":\"5.5\",\"diameter\":\"0\",\"weight\":\"0.22\",\"color\":\"\",\"material\":\"dvd\",\"release_date\":\"2003-11-06\",\"created_on\":\"2010-07-12 11:48:09\",\"updated_on\":\"2014-12-09 09:55:49\",\"discountable\":\"0\",\"max_discount_rate\":\"0\",\"type_id\":\"36\",\"saleable\":\"1\"}]}");

        $mock = new MockHandler([
            $response
        ]);

        $handler = HandlerStack::create($mock);
        $client = new Client(['handler' => $handler]);

        $repo = new ProductRepository($client);

        $result = $repo->findAll(10);
        
        $this->assertEquals(10, sizeof($result->getItems()));
        $this->assertEquals("18578", $result->getItems()[0]->getId());
        $this->assertEquals(52025, $result->getTotal());
        
    }
    
    public function testFind() {

        $response = new Response(200, [], '{"product":{"id":"18578","sku":"AL1007XO","name":"PVC LACE UP GLOVES ","description":"XOXO Allure Lingerie PVC Gloves. Super sexy gloves will complete your seductress look with these elbow-length lace up PVC gloves. Able to be adjusted as tight as you desire with a lace-and-grommet closure, they extend over the tops of the hands and have a built-in finger loop for a sleek look. A great way to add extra vamp to your look in the bedroom or at the club! Color: Black Type: Gloves Material: PVC Closure: Lacing Length: Elbow Special Features: Finger Loop. ","keywords":"","price":"9","active":"0","manufacturer_id":"264","barcode":"883045010070","stock_quantity":"0","reorder_quantity":"0","video":"0","on_sale":"0","height":"0","length":"0","width":"0","diameter":"0","weight":"0","color":"Black","material":"PVC","release_date":"2008-10-11","created_on":"2010-07-12 11:48:09","updated_on":"2015-09-30 14:57:38","discountable":"0","max_discount_rate":"0","type_id":"36","saleable":"1"}}');

        $mock = new MockHandler([
            $response
        ]);

        $handler = HandlerStack::create($mock);
        $client = new Client(['handler' => $handler]);

        $repo = new ProductRepository($client);

        $result = $repo->find(18578);
        
        $this->assertEquals("18578", $result->getId());
        
    }

}
